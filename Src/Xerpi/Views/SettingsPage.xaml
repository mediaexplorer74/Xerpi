<?xml version="1.0" encoding="utf-8" ?>
<views:NavigablePage xmlns="http://xamarin.com/schemas/2014/forms"
                     xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                     xmlns:d="http://xamarin.com/schemas/2014/forms/design"
                     xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"             
                     mc:Ignorable="d"
                     
                     x:Class="Xerpi.Views.SettingsPage"
             
                     xmlns:views="clr-namespace:Xerpi.Views"
                     xmlns:converters="clr-namespace:Xerpi.Converters"
                     xmlns:vms="clr-namespace:Xerpi.ViewModels" 
                     BackgroundColor="{DynamicResource BackgroundColor}"
                     Title="Settings">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:CollectionToCountConverter x:Key="CollectionToCountConverter"/>
            <converters:InvertBoolConverter x:Key="InvertBoolConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>

  <Grid>
    <Grid.RowDefinitions>
        <RowDefinition Height="*"/>
        <!--RowDefinition Height="*"/-->
        <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

   
        <StackLayout Grid.Row="0" Padding="20" Spacing="20">
            
            
          <Picker Title="Application Theme" 
                ItemsSource="{Binding ThemeChoices}"
                SelectedItem="{Binding SelectedTheme, Mode=TwoWay}"
                TextColor="{DynamicResource PrimaryTextColor}"/>    

            <Label Text="Compact Mode" FontAttributes="Bold"/>
            <Switch IsToggled="{Binding CompactMode}"/>
            <Label Text="Enable compact display for small screens" FontSize="Small"/>

            <Label Text="Show Score Icons" FontAttributes="Bold"/>
            <Switch IsToggled="{Binding ShowScoreIcons}"/>
            <Label Text="Show star and arrow counters under images" FontSize="Small"/>

              
            <!--CollectionView ItemsSource="{Binding Filters}" IsVisible="Visible">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <StackLayout>
                            <Label Text="{Binding Name}" FontAttributes="Bold"/>
                            <Label Text="{Binding Description}" FontSize="Small"/>
                            <Button Text="Use" Command="{Binding UseCommand}"/>
                        </StackLayout>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView-->
           
            
          <CollectionView ItemsSource="{Binding Filters}">
            <CollectionView.Header>
                <Label Text="Filters" Padding="10, 5, 10, 5"/>
            </CollectionView.Header>
              
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="vms:SettingsFilterViewModel">
                     <Grid RowSpacing="0" VerticalOptions="FillAndExpand">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>                                
                        </Grid.RowDefinitions>
                             
                        <Label Grid.Row="0" Text="{Binding BackingFilter.Name}"/>
                             
                        <Label Grid.Row="1">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="Used by "/>
                                    <Span Text="{Binding BackingFilter.UserCount}"/>
                                    <Span Text=" people."/>
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                             
                        <Label Grid.Row="2">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="Spoilers "/>
                                    <Span Text="{Binding BackingFilter.SpoileredTagIds, Converter={StaticResource CollectionToCountConverter}}"/>
                                    <Span Text=", and hides "/>
                                    <Span Text="{Binding BackingFilter.HiddenTagIds, Converter={StaticResource CollectionToCountConverter}}"/>
                                    <Span Text=" tags."/>
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                             
                        <Label Grid.Row="3" Text="{Binding BackingFilter.Description}"/>
                             
                        <StackLayout Grid.Row="4" Orientation="Horizontal" HorizontalOptions="End">
                            <Button HorizontalOptions="End" Text="Details"/>
                            <Button HorizontalOptions="End"                                             
                                Text="{Binding UseText}" 
                                Command="{Binding UseFilterCommand}"/>
                        </StackLayout>
                     </Grid> 
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
            
      </StackLayout>



      <ActivityIndicator Grid.Row="1" HorizontalOptions="Center" 
                VerticalOptions="Center"
                IsRunning="{Binding IsLoading}"
                IsEnabled="{Binding IsLoading}"
                IsVisible="{Binding IsLoading}"/>
    </Grid>

</views:NavigablePage>